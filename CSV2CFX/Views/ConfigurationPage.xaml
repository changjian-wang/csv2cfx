<Page x:Class="CSV2CFX.Views.ConfigurationPage"
      xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
      xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
      xmlns:ui="http://schemas.lepo.co/wpfui/2022/xaml"
      Title="Configuration">

    <Grid>
        <Grid.RowDefinitions>
            <RowDefinition Height="*"/>
            <RowDefinition Height="Auto"/>
        </Grid.RowDefinitions>

        <!-- 主要内容区域 -->
        <ScrollViewer Grid.Row="0" VerticalScrollBarVisibility="Auto" Margin="20,20,20,10">
            <Grid>
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="20"/>
                    <ColumnDefinition Width="*"/>
                </Grid.ColumnDefinitions>

                <!-- Left Column -->
                <StackPanel Grid.Column="0">

                    <!-- Logging Settings -->
                    <ui:CardExpander Header="📋 Logging Settings" IsExpanded="False" Margin="0,0,0,15">
                        <StackPanel Margin="15">
                            <Label Content="Default Log Level:" Target="{Binding ElementName=DefaultLogLevelTextBox}"/>
                            <ui:TextBox 
                                Name="DefaultLogLevelTextBox"
                                Text="{Binding DefaultLogLevel, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"
                                PlaceholderText="Default Log Level"
                                Margin="0,0,0,10"/>

                            <Label Content="Microsoft Hosting Lifetime Log Level:" Target="{Binding ElementName=MicrosoftLogLevelTextBox}"/>
                            <ui:TextBox 
                                Name="MicrosoftLogLevelTextBox"
                                Text="{Binding MicrosoftHostingLifetimeLogLevel, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"
                                PlaceholderText="Microsoft Hosting Lifetime Log Level"/>
                        </StackPanel>
                    </ui:CardExpander>

                    <!-- Protocol Selection -->
                    <ui:CardExpander Header="🔗 Protocol Selection" IsExpanded="True" Margin="0,0,0,15">
                        <StackPanel Margin="15">
                            <Label Content="Message Protocol:" Target="{Binding ElementName=ProtocolTypeComboBox}"/>
                            <ComboBox Name="ProtocolTypeComboBox" 
                                      SelectedIndex="{Binding ProtocolType, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"
                                      Margin="0,0,0,10">
                                <ComboBoxItem Content="AMQP (RabbitMQ)" />
                                <ComboBoxItem Content="MQTT" />
                            </ComboBox>
                        </StackPanel>
                    </ui:CardExpander>

                    <!-- RabbitMQ Settings -->
                    <ui:CardExpander Header="🐰 RabbitMQ Settings" IsExpanded="True" Margin="0,0,0,15">
                        <StackPanel Margin="15">
                            <Label Content="Host Name:" Target="{Binding ElementName=HostNameTextBox}"/>
                            <ui:TextBox 
                                Name="HostNameTextBox"
                                Text="{Binding HostName, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"
                                PlaceholderText="Host Name"
                                Margin="0,0,0,10"/>

                            <Label Content="User Name:" Target="{Binding ElementName=UserNameTextBox}"/>
                            <ui:TextBox 
                                Name="UserNameTextBox"
                                Text="{Binding UserName, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"
                                PlaceholderText="User Name"
                                Margin="0,0,0,10"/>

                            <Label Content="Password:" Target="{Binding ElementName=PasswordBox}"/>
                            <ui:PasswordBox 
                                Name="PasswordBox"
                                Password="{Binding Password, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"
                                PlaceholderText="Password"
                                Margin="0,0,0,10"/>

                            <Label Content="Port:" Target="{Binding ElementName=PortNumberBox}"/>
                            <ui:NumberBox 
                                Name="PortNumberBox"
                                Value="{Binding Port, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"
                                PlaceholderText="Port"
                                Minimum="1" Maximum="65535"
                                Margin="0,0,0,10"/>

                            <Label Content="Virtual Host:" Target="{Binding ElementName=VirtualHostTextBox}"/>
                            <ui:TextBox 
                                Name="VirtualHostTextBox"
                                Text="{Binding VirtualHost, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"
                                PlaceholderText="Virtual Host"
                                Margin="0,0,0,10"/>

                            <ui:ToggleSwitch 
                                Content="Automatic Recovery Enabled"
                                IsChecked="{Binding AutomaticRecoveryEnabled, Mode=TwoWay}"
                                Margin="0,0,0,10"/>

                            <Label Content="Network Recovery Interval (Seconds):" Target="{Binding ElementName=NetworkRecoveryNumberBox}"/>
                            <ui:NumberBox 
                                Name="NetworkRecoveryNumberBox"
                                Value="{Binding NetworkRecoveryIntervalSeconds, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"
                                PlaceholderText="Network Recovery Interval (Seconds)"
                                Minimum="1"/>
                        </StackPanel>
                    </ui:CardExpander>

                    <!-- MQTT Settings -->
                    <ui:CardExpander Header="📡 MQTT Settings" IsExpanded="False" Margin="0,0,0,15">
                        <StackPanel Margin="15">
                            <Label Content="Broker Host:" Target="{Binding ElementName=MqttBrokerHostTextBox}"/>
                            <ui:TextBox 
                                Name="MqttBrokerHostTextBox"
                                Text="{Binding MqttBrokerHost, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"
                                PlaceholderText="MQTT Broker Host"
                                Margin="0,0,0,10"/>

                            <Label Content="Broker Port:" Target="{Binding ElementName=MqttBrokerPortNumberBox}"/>
                            <ui:NumberBox 
                                Name="MqttBrokerPortNumberBox"
                                Value="{Binding MqttBrokerPort, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"
                                PlaceholderText="MQTT Broker Port"
                                Minimum="1" Maximum="65535"
                                Margin="0,0,0,10"/>

                            <Label Content="Username:" Target="{Binding ElementName=MqttUsernameTextBox}"/>
                            <ui:TextBox 
                                Name="MqttUsernameTextBox"
                                Text="{Binding MqttUsername, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"
                                PlaceholderText="MQTT Username (optional)"
                                Margin="0,0,0,10"/>

                            <Label Content="Password:" Target="{Binding ElementName=MqttPasswordBox}"/>
                            <ui:PasswordBox 
                                Name="MqttPasswordBox"
                                Password="{Binding MqttPassword, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"
                                PlaceholderText="MQTT Password (optional)"
                                Margin="0,0,0,10"/>

                            <Label Content="Client ID:" Target="{Binding ElementName=MqttClientIdTextBox}"/>
                            <ui:TextBox 
                                Name="MqttClientIdTextBox"
                                Text="{Binding MqttClientId, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"
                                PlaceholderText="MQTT Client ID (auto-generated if empty)"
                                Margin="0,0,0,10"/>

                            <Label Content="Topic Prefix:" Target="{Binding ElementName=MqttTopicPrefixTextBox}"/>
                            <ui:TextBox 
                                Name="MqttTopicPrefixTextBox"
                                Text="{Binding MqttTopicPrefix, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"
                                PlaceholderText="MQTT Topic Prefix"
                                Margin="0,0,0,10"/>

                            <ui:ToggleSwitch 
                                Content="Use TLS/SSL"
                                IsChecked="{Binding MqttUseTls, Mode=TwoWay}"
                                Margin="0,0,0,10"/>

                            <ui:ToggleSwitch 
                                Content="Clean Session"
                                IsChecked="{Binding MqttCleanSession, Mode=TwoWay}"
                                Margin="0,0,0,10"/>

                            <Label Content="Keep Alive Period (Seconds):" Target="{Binding ElementName=MqttKeepAliveNumberBox}"/>
                            <ui:NumberBox 
                                Name="MqttKeepAliveNumberBox"
                                Value="{Binding MqttKeepAlivePeriod, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"
                                PlaceholderText="Keep Alive Period"
                                Minimum="10" Maximum="3600"
                                Margin="0,0,0,10"/>

                            <Label Content="Connection Timeout (Seconds):" Target="{Binding ElementName=MqttConnectionTimeoutNumberBox}"/>
                            <ui:NumberBox 
                                Name="MqttConnectionTimeoutNumberBox"
                                Value="{Binding MqttConnectionTimeout, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"
                                PlaceholderText="Connection Timeout"
                                Minimum="5" Maximum="300"/>
                        </StackPanel>
                    </ui:CardExpander>

                    <!-- RabbitMQ Publisher Settings -->
                    <ui:CardExpander Header="📤 Publisher Settings" IsExpanded="False" Margin="0,0,0,15">
                        <StackPanel Margin="15">
                            <Label Content="Publisher Prefix:" Target="{Binding ElementName=PrefixTextBox}"/>
                            <ui:TextBox 
                                Name="PrefixTextBox"
                                Text="{Binding Prefix, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"
                                PlaceholderText="Publisher Prefix"/>
                        </StackPanel>
                    </ui:CardExpander>

                    <!-- API Settings -->
                    <ui:CardExpander Header="🌐 API Settings" IsExpanded="False" Margin="0,0,0,15">
                        <StackPanel Margin="15">
                            <Label Content="API Endpoint:" Target="{Binding ElementName=EndpointTextBox}"/>
                            <ui:TextBox 
                                Name="EndpointTextBox"
                                Text="{Binding Endpoint, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"
                                PlaceholderText="API Endpoint"
                                Margin="0,0,0,10"/>

                            <Label Content="Login URI:" Target="{Binding ElementName=LoginUriTextBox}"/>
                            <ui:TextBox 
                                Name="LoginUriTextBox"
                                Text="{Binding LoginUri, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"
                                PlaceholderText="Login URI"/>
                        </StackPanel>
                    </ui:CardExpander>

                    <!-- Background Task Settings -->
                    <ui:CardExpander Header="⚙️ Background Task Settings" IsExpanded="False" Margin="0,0,0,15">
                        <StackPanel Margin="15">
                            <Label Content="Max Concurrency:" Target="{Binding ElementName=MaxConcurrencyNumberBox}"/>
                            <ui:NumberBox 
                                Name="MaxConcurrencyNumberBox"
                                Value="{Binding MaxConcurrency, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"
                                PlaceholderText="Max Concurrency"
                                Minimum="1" Maximum="100"
                                Margin="0,0,0,10"/>

                            <Label Content="Delay Between Batches (ms):" Target="{Binding ElementName=DelayNumberBox}"/>
                            <ui:NumberBox 
                                Name="DelayNumberBox"
                                Value="{Binding DelayBetweenBatchesMs, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"
                                PlaceholderText="Delay Between Batches (ms)"
                                Minimum="0"/>
                        </StackPanel>
                    </ui:CardExpander>
                </StackPanel>

                <!-- Right Column -->
                <StackPanel Grid.Column="2">

                    <!-- CSV File Paths -->
                    <ui:CardExpander Header="📁 CSV File Paths" IsExpanded="True" Margin="0,0,0,15">
                        <StackPanel Margin="15">
                            <Label Content="Production Information File:"/>
                            <Grid Margin="0,0,0,15">
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="*"/>
                                    <ColumnDefinition Width="Auto"/>
                                </Grid.ColumnDefinitions>
                                <ui:TextBox 
                                    Grid.Column="0"
                                    Name="ProductionFileTextBox"
                                    Text="{Binding ProductionInformationFilePath, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"
                                    PlaceholderText="Select production information file..."/>
                                <ui:Button 
                                    Grid.Column="1" 
                                    Content="Browse" 
                                    Margin="8,0,0,0"
                                    Click="BrowseProductionFile_Click"/>
                            </Grid>

                            <Label Content="Machine Status Information File:"/>
                            <Grid Margin="0,0,0,15">
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="*"/>
                                    <ColumnDefinition Width="Auto"/>
                                </Grid.ColumnDefinitions>
                                <ui:TextBox 
                                    Grid.Column="0"
                                    Name="MachineStatusFileTextBox"
                                    Text="{Binding MachineStatusInformationFilePath, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"
                                    PlaceholderText="Select machine status file..."/>
                                <ui:Button 
                                    Grid.Column="1" 
                                    Content="Browse" 
                                    Margin="8,0,0,0"
                                    Click="BrowseMachineStatusFile_Click"/>
                            </Grid>

                            <Label Content="Process Data Files Folder:"/>
                            <Grid>
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="*"/>
                                    <ColumnDefinition Width="Auto"/>
                                </Grid.ColumnDefinitions>
                                <ui:TextBox 
                                    Grid.Column="0"
                                    Name="ProcessDataFolderTextBox"
                                    Text="{Binding ProcessDataFilesFilePath, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"
                                    PlaceholderText="Select process data folder..."/>
                                <ui:Button 
                                    Grid.Column="1" 
                                    Content="Browse" 
                                    Margin="8,0,0,0"
                                    Click="BrowseProcessDataFolder_Click"/>
                            </Grid>
                        </StackPanel>
                    </ui:CardExpander>

                    <!-- Machine Info -->
                    <ui:CardExpander Header="🖥️ Machine Information" IsExpanded="True" Margin="0,0,0,15">
                        <StackPanel Margin="15">
                            <Label Content="Unique ID:" Target="{Binding ElementName=UniqueIdTextBox}"/>
                            <ui:TextBox 
                                Name="UniqueIdTextBox"
                                Text="{Binding UniqueId, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"
                                PlaceholderText="Unique ID"
                                Margin="0,0,0,10"/>

                            <Label Content="Version:" Target="{Binding ElementName=VersionTextBox}"/>
                            <ui:TextBox 
                                Name="VersionTextBox"
                                Text="{Binding Version, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"
                                PlaceholderText="Version"
                                Margin="0,0,0,10"/>

                            <Label Content="Heartbeat Frequency (Seconds):" Target="{Binding ElementName=HeartbeatNumberBox}"/>
                            <ui:NumberBox 
                                Name="HeartbeatNumberBox"
                                Value="{Binding HeartbeatFrequency, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"
                                PlaceholderText="Heartbeat Frequency (Seconds)"
                                Minimum="1" Maximum="3600"/>
                        </StackPanel>
                    </ui:CardExpander>

                    <!-- Machine Metadata -->
                    <ui:CardExpander Header="ℹ️ Machine Metadata" IsExpanded="True" Margin="0,0,0,15">
                        <StackPanel Margin="15">
                            <Grid>
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="*"/>
                                    <ColumnDefinition Width="10"/>
                                    <ColumnDefinition Width="*"/>
                                </Grid.ColumnDefinitions>
                                <Grid.RowDefinitions>
                                    <RowDefinition Height="Auto"/>
                                    <RowDefinition Height="Auto"/>
                                    <RowDefinition Height="10"/>
                                    <RowDefinition Height="Auto"/>
                                    <RowDefinition Height="Auto"/>
                                    <RowDefinition Height="10"/>
                                    <RowDefinition Height="Auto"/>
                                    <RowDefinition Height="Auto"/>
                                    <RowDefinition Height="10"/>
                                    <RowDefinition Height="Auto"/>
                                    <RowDefinition Height="Auto"/>
                                    <RowDefinition Height="10"/>
                                    <RowDefinition Height="Auto"/>
                                    <RowDefinition Height="Auto"/>
                                </Grid.RowDefinitions>

                                <Label Grid.Row="0" Grid.Column="0" Content="Building:" Target="{Binding ElementName=BuildingTextBox}"/>
                                <ui:TextBox 
                                    Grid.Row="1" Grid.Column="0"
                                    Name="BuildingTextBox"
                                    Text="{Binding Building, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"
                                    PlaceholderText="Building"/>

                                <Label Grid.Row="0" Grid.Column="2" Content="Device:" Target="{Binding ElementName=DeviceTextBox}"/>
                                <ui:TextBox 
                                    Grid.Row="1" Grid.Column="2"
                                    Name="DeviceTextBox"
                                    Text="{Binding Device, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"
                                    PlaceholderText="Device"/>

                                <Label Grid.Row="3" Grid.Column="0" Content="Area Name:" Target="{Binding ElementName=AreaNameTextBox}"/>
                                <ui:TextBox 
                                    Grid.Row="4" Grid.Column="0"
                                    Name="AreaNameTextBox"
                                    Text="{Binding AreaName, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"
                                    PlaceholderText="Area Name"/>

                                <Label Grid.Row="3" Grid.Column="2" Content="Organization:" Target="{Binding ElementName=OrganizationTextBox}"/>
                                <ui:TextBox 
                                    Grid.Row="4" Grid.Column="2"
                                    Name="OrganizationTextBox"
                                    Text="{Binding Organization, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"
                                    PlaceholderText="Organization"/>

                                <Label Grid.Row="6" Grid.Column="0" Content="Line Name:" Target="{Binding ElementName=LineNameTextBox}"/>
                                <ui:TextBox 
                                    Grid.Row="7" Grid.Column="0"
                                    Name="LineNameTextBox"
                                    Text="{Binding LineName, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"
                                    PlaceholderText="Line Name"/>

                                <Label Grid.Row="6" Grid.Column="2" Content="Site Name:" Target="{Binding ElementName=SiteNameTextBox}"/>
                                <ui:TextBox 
                                    Grid.Row="7" Grid.Column="2"
                                    Name="SiteNameTextBox"
                                    Text="{Binding SiteName, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"
                                    PlaceholderText="Site Name"/>

                                <Label Grid.Row="9" Grid.Column="0" Content="Station Name:" Target="{Binding ElementName=StationNameTextBox}"/>
                                <ui:TextBox 
                                    Grid.Row="10" Grid.Column="0"
                                    Name="StationNameTextBox"
                                    Text="{Binding StationName, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"
                                    PlaceholderText="Station Name"/>

                                <Label Grid.Row="9" Grid.Column="2" Content="Process Type:" Target="{Binding ElementName=ProcessTypeTextBox}"/>
                                <ui:TextBox 
                                    Grid.Row="10" Grid.Column="2"
                                    Name="ProcessTypeTextBox"
                                    Text="{Binding ProcessType, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"
                                    PlaceholderText="Process Type"/>

                                <Label Grid.Row="12" Grid.Column="0" Content="Machine Name:" Target="{Binding ElementName=MachineNameTextBox}"/>
                                <ui:TextBox 
                                    Grid.Row="13" Grid.Column="0"
                                    Name="MachineNameTextBox"
                                    Text="{Binding MachineName, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"
                                    PlaceholderText="Machine Name"/>

                                <Label Grid.Row="12" Grid.Column="2" Content="Created By:" Target="{Binding ElementName=CreatedByTextBox}"/>
                                <ui:TextBox 
                                    Grid.Row="13" Grid.Column="2"
                                    Name="CreatedByTextBox"
                                    Text="{Binding CreatedBy, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"
                                    PlaceholderText="Created By"/>
                            </Grid>
                        </StackPanel>
                    </ui:CardExpander>
                </StackPanel>
            </Grid>
        </ScrollViewer>

        <!-- 底部操作按钮区域 -->
        <Border Grid.Row="1" 
                Background="{DynamicResource ApplicationBackgroundBrush}" 
                BorderBrush="{DynamicResource ControlElevationBorderBrush}" 
                BorderThickness="0,1,0,0"
                Padding="20,15">
            <StackPanel Orientation="Horizontal" HorizontalAlignment="Center">
                <ui:Button 
                    Content="💾 Save Configuration" 
                    Appearance="Primary"
                    MinWidth="150"
                    Height="40"
                    Click="SaveConfiguration_Click"/>

                <ui:Button 
                    Content="📂 Load Configuration" 
                    Appearance="Secondary"
                    MinWidth="150"
                    Height="40"
                    Margin="15,0,0,0"
                    Click="LoadConfiguration_Click"/>

                <ui:Button 
                    Content="🔄 Reset to Default" 
                    Appearance="Caution"
                    MinWidth="150"
                    Height="40"
                    Margin="15,0,0,0"
                    Click="ResetConfiguration_Click"/>

                <ui:Button 
                    Content="🔗 Test Connection" 
                    Appearance="Success"
                    MinWidth="150"
                    Height="40"
                    Margin="15,0,0,0"
                    Click="TestConnection_Click"/>
            </StackPanel>
        </Border>
    </Grid>
</Page>